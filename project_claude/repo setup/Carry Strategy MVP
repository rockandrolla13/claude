# Carry Strategy MVP - Conversation Memory

## Project Context
Building MVP for algorithmic corporate bond carry trading strategy using Claude Code framework.

---

## Architecture (Final)

```
carry-strategy-research/
â”œâ”€â”€ .claude/                              â† LIVES AT PROJECT ROOT
â”‚   â”œâ”€â”€ skills/
â”‚   â”‚   â””â”€â”€ bond-data-profiler/
â”‚   â”‚       â”œâ”€â”€ SKILL.md                  â† multi-mode skill
â”‚   â”‚       â”œâ”€â”€ column-mappings.md
â”‚   â”‚       â””â”€â”€ modes/
â”‚   â”‚           â”œâ”€â”€ profile.md            â† data quality, gaps
â”‚   â”‚           â”œâ”€â”€ forward-returns.md    â† T+1, T+5, T+20 returns
â”‚   â”‚           â””â”€â”€ carry.md              â† carry calculation
â”‚   â”‚   â”œâ”€â”€ carry-execution/
â”‚   â”‚   â”‚   â””â”€â”€ SKILL.md
â”‚   â”‚   â”œâ”€â”€ preregistration-validator/
â”‚   â”‚   â”‚   â””â”€â”€ SKILL.md
â”‚   â”‚   â””â”€â”€ data-availability-checker/
â”‚   â”‚       â”œâ”€â”€ SKILL.md
â”‚   â”‚       â”œâ”€â”€ rating-mappings.md
â”‚   â”‚       â””â”€â”€ data-sources.md
â”‚   â””â”€â”€ commands/
â”‚       â”œâ”€â”€ run-carry.md
â”‚       â”œâ”€â”€ validate-prereg.md
â”‚       â”œâ”€â”€ profile-data.md
â”‚       â””â”€â”€ check-data.md
â”œâ”€â”€ CLAUDE.md                             â† project constitution
â”œâ”€â”€ plan.md                               â† execution plan
â”œâ”€â”€ prereg.yaml                           â† frozen pre-registration
â”œâ”€â”€ research/
â”‚   â”œâ”€â”€ preregistration/
â”‚   â”‚   â””â”€â”€ carry_structural_v0.yaml
â”‚   â””â”€â”€ hypotheses/
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ architecture.md
â”‚   â”œâ”€â”€ data-sources.md
â”‚   â””â”€â”€ methodology.md
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ reference/
â”‚   â”œâ”€â”€ pricing/
â”‚   â””â”€â”€ trace/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ bond_universe.py              â† NEXT TO BUILD
â”‚   â”œâ”€â”€ signals/
â”‚   â”‚   â””â”€â”€ carry.py
â”‚   â”œâ”€â”€ portfolio/
â”‚   â”œâ”€â”€ execution/
â”‚   â””â”€â”€ backtest/
â”œâ”€â”€ reports/                              â† profiler outputs
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ signals/
â”‚   â””â”€â”€ fixtures/
â””â”€â”€ notebooks/
```

---

## Key Decisions Made

### 1. Skill Organization
- **One skill with modes** (not separate skills)
- Bond-data-profiler handles: profile, forward-returns, carry
- Shared column-mappings.md across all modes

### 2. Carry Formula
```
gross_carry = (oas / 10000) * duration
net_carry = gross_carry - funding_rate * duration
roll_down â‰ˆ -duration * (yield(T-dt) - yield(T)) / dt
```

### 3. Data Conventions
- Yields in decimal (0.05 = 5%)
- Duration = modified duration
- All dates as pd.Timestamp
- OAS in basis points

### 4. Build Sequence
```
Phase 1: Data Layer
  Conv 1: Profile data (use bond-data-profiler skill)
  Conv 2: bond_universe.py loader
  Conv 3: Yield curve construction

Phase 2: Signals
  Conv 4: Carry calculation
  Conv 5: Signal normalization

Phase 3: Backtest
  Conv 6: Design (Opus)
  Conv 7: Implementation (Sonnet)
  Conv 8: Transaction costs
  Conv 9: P&L attribution

Phase 4: Validation
  Conv 10: Sanity checks
  Conv 11: Risk metrics
```

---

## Bond-Data-Profiler Skill Spec

### SKILL.md
```markdown
# Bond Data Profiler Skill

## Purpose
Profile bond datasets and compute derived analytics for carry strategy.

## Trigger
- "profile [path]" â†’ data quality mode
- "compute forward returns [path]" â†’ returns mode
- "calculate carry [path]" â†’ carry mode

## Modes
1. Profile: scan, quality, gaps â†’ reports/{dataset}_summary.md
2. Forward Returns: 1d, 5d, 20d, 60d â†’ data/{dataset}_forward_returns.parquet
3. Carry: gross/net carry â†’ data/{dataset}_carry_signals.parquet

## Workflow
1. Always profile first
2. Then returns or carry
3. All use column-mappings.md
```

### column-mappings.md
```markdown
## Identifiers (priority)
cusip, isin, figi, instrument_id, bond_id

## Dates
as_of_date, date, pricing_date, trade_date, timestamp

## Carry Inputs
| Field | Variations |
|-------|------------|
| OAS | oas, option_adjusted_spread, oas_bp |
| Duration | mod_duration, modified_duration, duration |
| Yield | ytm, yield_to_maturity, yield_to_worst |
| Price | price, clean_price, mid_price |
| Rating | rating, sp_rating, composite_rating |
| Sector | sector, industry, gics_sector |

## Funding
sofr, libor, treasury_yield, swap_rate
```

---

## CLAUDE.md Additions Needed

```markdown
## Skills
- `.claude/skills/bond-data-profiler/` â€” profile, forward returns, carry
- Invoke: "Profile bond data at [path]"
- Outputs: reports/

## Data Profiling Workflow
1. Profile first â†’ understand columns, gaps
2. Build loader using exact column names
3. Re-profile after data source changes

## Conventions
- Yields: decimal (0.05 not 5%)
- Duration: modified
- OAS: basis points
- Dates: pd.Timestamp
- Columns: lowercase_with_underscores
```

---

## Current Status

âœ… Completed:
- CLAUDE.md created
- plan.md created
- prereg.yaml created
- Repo structure exists

ğŸ”² Next Actions:
1. Create bond-data-profiler skill files
2. Profile existing data
3. Build bond_universe.py using profile output

---

## Prompt Templates

### Create Skill
```
Create the bond-data-profiler skill at .claude/skills/bond-data-profiler/

Include modes for: profile, forward-returns, carry
Reference prereg.yaml for carry formula
Output to reports/ for profiles, data/ for computed signals
```

### Profile Data
```
Profile the bond data at [DATABASE_PATH]

Use the bond-data-profiler skill.
Flag carry-critical fields: OAS, duration, yield
Recommend column mapping for src/data/bond_universe.py
```

### Build Loader
```
Build the bond universe loader.

Data source: [PATH]
Output: DataFrame [cusip, issuer, coupon, maturity_date, rating, sector, duration, oas]
Filter: IG only, USD, active
File: src/data/bond_universe.py
Reference column names from profile report.
```

---

## User Context
- Has database path for bond data
- User preference: technical/mathematical responses with clear intuition
- Framework: Claude Code best practices applied to quant development
